<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Novel Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #game-container {
            width: 80%;
            max-width: 800px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #chapter-container, #location-container {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #name-container {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #text-container {
            min-height: 150px;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="chapter-container"></div>
        <div id="location-container"></div>
        <div id="name-container"></div>
        <div id="text-container"></div>
    </div>

    <script>
        const chapterContainer = document.getElementById('chapter-container');
        const locationContainer = document.getElementById('location-container');
        const nameContainer = document.getElementById('name-container');
        const textContainer = document.getElementById('text-container');

        const script = [
            { type: "chapter", text: "Prologue" },
            { type: "location", text: "February 13th, 2045; 12:30 - A weird room" },
            { name: "", text: "A series of pods are organized in different rows and columns. Stairs like the ones that are used in large public libraries are used to reach the pods. At the centre of the colossal structure, we see a glass ceiling." },
            { name: "", text: "My eyes suddenly open as I hear a voice with a peculiar cadence" },
            { name: "A voice", text: "It's not that bad." },
            { name: "A voice", text: "You know what? It is actually quite cute." },
            { name: "A voice", text: "I almost envy you." },
            { name: "", text: "A Character appears at the centre of the screen. He appears cheerful in a way that contrasts strikingly with the gothic environment. He points at the high ceiling, which appears to be at least a whopping thirty metres in height." },
            { name: "???", text: "At least you have high ceilings." },
            { name: "???", text: "It's a shame though. They could have made a couple of floors more. Or a penthouse." },
            { name: "???", text: "Oooh, at least some kind of a loft situation." },
            { name: "???", text: "Instead, they just chose to put as many beds as possible. *sigh*." },
            { name: "???", text: "Aesthetics are defaced on a daily basis in this city." },
            { name: "???", text: "*grins* But you have more chances to make friends though!" },
        ];

        let currentLine = 0;
        let isTyping = false;
        let typingSpeed = 30; // milliseconds per character

        let audioContext;
        let oscillator;

        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playTypeSound() {
            if (!audioContext) initAudio();
            
            oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4 note
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function typeWriter(text, index = 0) {
            if (index < text.length) {
                textContainer.innerHTML += text.charAt(index);
                playTypeSound();
                setTimeout(() => typeWriter(text, index + 1), typingSpeed);
            } else {
                isTyping = false;
            }
        }

        function displayFullText() {
            if (isTyping) {
                isTyping = false;
                const currentItem = script[currentLine - 1];
                if (currentItem && currentItem.text) {
                    textContainer.innerHTML = currentItem.text;
                }
            }
        }

        function displayNextLine() {
            if (currentLine < script.length) {
                const currentItem = script[currentLine];
                
                if (currentItem.type === "chapter") {
                    chapterContainer.textContent = currentItem.text;
                    locationContainer.textContent = "";
                    nameContainer.textContent = "";
                    textContainer.innerHTML = "";
                } else if (currentItem.type === "location") {
                    locationContainer.textContent = currentItem.text;
                    nameContainer.textContent = "";
                    textContainer.innerHTML = "";
                } else {
                    nameContainer.textContent = currentItem.name;
                    textContainer.innerHTML = "";
                    isTyping = true;
                    typeWriter(currentItem.text);
                }
                
                currentLine++;
            } else {
                chapterContainer.textContent = '';
                locationContainer.textContent = '';
                nameContainer.textContent = '';
                textContainer.innerHTML = "End of demo. Thank you for playing!";
            }
        }

        let doubleClickTimer = null;
        let preventSingleClick = false;

        textContainer.addEventListener('click', (e) => {
            if (doubleClickTimer == null) {
                doubleClickTimer = setTimeout(() => {
                    if (!preventSingleClick) {
                        if (isTyping) {
                            displayFullText();
                        } else {
                            displayNextLine();
                        }
                    }
                    doubleClickTimer = null;
                    preventSingleClick = false;
                }, 300);
            }
        });

        textContainer.addEventListener('dblclick', (e) => {
            clearTimeout(doubleClickTimer);
            preventSingleClick = true;
            doubleClickTimer = null;
            while (currentLine < script.length) {
                displayFullText();
                displayNextLine();
            }
        });

        // Display the first line immediately
        displayNextLine();
    </script>
</body>
</html>
